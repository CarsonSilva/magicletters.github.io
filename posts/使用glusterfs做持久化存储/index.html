<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.74.3" />
	
	<link rel="icon" href="/static/images/logo.png">
	
	<title>使用glusterfs做持久化存储 | DreamAsHourse</title>
	
	

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用glusterfs做持久化存储"/>
<meta name="twitter:description" content="安装glusterfs 我们直接在物理机上使用yum安装，如果你选择在kubernetes上安装，请参考：https://github."/>

	<meta property="og:title" content="使用glusterfs做持久化存储" />
<meta property="og:description" content="安装glusterfs 我们直接在物理机上使用yum安装，如果你选择在kubernetes上安装，请参考：https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://magicletters.github.io/posts/%E4%BD%BF%E7%94%A8glusterfs%E5%81%9A%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/" />
<meta property="article:published_time" content="2020-07-15T10:58:46+00:00" />
<meta property="article:modified_time" content="2020-07-15T10:58:46+00:00" />


	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
	 crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	<link href="/css/medium.css" rel="stylesheet">
	<link href="/css/additional.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="https://magicletters.github.io//">

            
            <img src="/static/images/logo.png" alt="logo">
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/posts">Posts</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/categories">Categories</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/tags">Tags</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/">About Me</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/static/imprint">Imprint</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
<div class="mainheading">
    <h1 class="sitetitle">DreamAsHourse</h1>
    <p class="lead">
         以梦为马🏇
    </p>
</div><div class="main-content">
        
        <div class="container">
            <div class="row">
                
                <div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset">
    <p>Share</p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=%e4%bd%bf%e7%94%a8glusterfs%e5%81%9a%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8&url=https%3a%2f%2fmagicletters.github.io%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8glusterfs%25E5%2581%259A%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=https%3a%2f%2fmagicletters.github.io%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8glusterfs%25E5%2581%259A%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>

        <li class="ml-1 mr-1">
        <a target="_blank" href="https://www.xing.com/spi/shares/new?url=https%3a%2f%2fmagicletters.github.io%2fposts%2f%25E4%25BD%25BF%25E7%2594%25A8glusterfs%25E5%2581%259A%25E6%258C%2581%25E4%25B9%2585%25E5%258C%2596%25E5%25AD%2598%25E5%2582%25A8%2f" onclick="window.open(this.href, 'xing-share', 'width=550,height=435');return false;">
        <i class="fab fa-xing"></i>
        </a>
        </li>        
    </ul>

    
</div>
</div>
                                
                <div class="col-md-9 flex-first flex-md-unordered">
                    <div class="mainheading">
                        	
                        
                        
                        
                        <div class="row post-top-meta">
                            <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right">
                                <img class="author-thumb" src="/static/images/author.png" alt="Zhu Jia">
                            </div>
                            <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left">
                                <a target="_blank" class="link-dark">Zhu Jia</a><br>
                                <span class="author-description">
                                    以梦为马<br>
                                    <i class="far fa-star"></i>
                                    Jul 15, 2020
                                    <i class="far fa-clock clock"></i>
                                    4 min read
                                </span>					
                            </div>
                        </div>			
                        	
                        
                                                
                        
                        <h1 class="posttitle">使用glusterfs做持久化存储</h1> 
                    </div>

                    
                    
                    
                    

                    
                    <div class="article-post">
                        <h2 id="安装glusterfs">安装glusterfs</h2>
<p>我们直接在物理机上使用yum安装，如果你选择在kubernetes上安装，请参考：https://github.com/gluster/gluster-kubernetes/blob/master/docs/setup-guide.md</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 先安装 gluster 源</span>
$ yum install centos-release-gluster -y

<span style="color:#75715e"># 安装 glusterfs 组件</span>
$ yum install -y glusterfs glusterfs-server glusterfs-fuse glusterfs-rdma glusterfs-geo-replication glusterfs-devel

<span style="color:#75715e"># 以下两步根据实际系统资源分配执行</span>
<span style="color:#75715e">## 创建 glusterfs 目录</span>
$ mkdir /opt/glusterd

<span style="color:#75715e">## 修改 glusterd 目录</span>
$ sed -i <span style="color:#e6db74">&#39;s/var\/lib/opt/g&#39;</span> /etc/glusterfs/glusterd.vol

<span style="color:#75715e"># 启动 glusterfs</span>
$ systemctl start glusterd.service

<span style="color:#75715e"># 设置开机启动</span>
$ systemctl enable glusterd.service

<span style="color:#75715e">#查看状态</span>
$ systemctl status glusterd.service
</code></pre></div><h2 id="配置-glusterfs">配置 glusterfs</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 配置 hosts</span>

$ echo <span style="color:#e6db74">&#39;192.168.11.11   k8s-master
</span><span style="color:#e6db74">&gt; 192.168.11.12   work-node1
</span><span style="color:#e6db74">&gt; 192.168.11.13   work-node2
</span><span style="color:#e6db74">&gt; 192.168.11.14   work-node3
</span><span style="color:#e6db74">&gt; 192.168.11.15   work-node4&#39;</span> &gt;&gt; /etc/hosts
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 开放端口(建议关闭服务器防火墙: systemctl disable --now firewalld)</span>
$ iptables -I INPUT -p tcp --dport <span style="color:#ae81ff">24007</span> -j ACCEPT

<span style="color:#75715e"># 创建存储目录</span>
$ mkdir /opt/gfs_data
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 添加节点到 集群</span>
<span style="color:#75715e"># 执行操作的本机不需要probe 本机</span>
<span style="color:#f92672">[</span>root@k8s-master ~<span style="color:#f92672">]</span>#
gluster peer probe work-node1
gluster peer probe work-node2
gluster peer probe work-node3
gluster peer probe work-node4

<span style="color:#75715e"># 查看集群状态</span>
$ gluster peer status
Number of Peers: <span style="color:#ae81ff">4</span>

Hostname: work-node1
Uuid: 6106a8b9-d8df-4ac9-9046-cdd5f2aa1f38
State: Peer in Cluster <span style="color:#f92672">(</span>Connected<span style="color:#f92672">)</span>

Hostname: work-node2
Uuid: e3675881-b0c7-48ef-a145-55ac62c2d1c2
State: Peer in Cluster <span style="color:#f92672">(</span>Connected<span style="color:#f92672">)</span>

Hostname: work-node3
Uuid: 30f2cf9a-3cb9-4a13-9d8e-8cfc7039d698
State: Peer in Cluster <span style="color:#f92672">(</span>Connected<span style="color:#f92672">)</span>

Hostname: work-node4
Uuid: c2d678fb-e5e6-4932-9ff0-1716f43aedd3
State: Peer in Cluster <span style="color:#f92672">(</span>Connected<span style="color:#f92672">)</span>

</code></pre></div><h2 id="配置-volume">配置 volume</h2>
<p>GlusterFS中的volume的模式有很多中，包括以下几种：</p>
<ul>
<li><strong>分布卷（默认模式）</strong>：即DHT, 也叫 分布卷: 将文件以hash算法随机分布到 一台服务器节点中存储。</li>
<li><strong>复制模式</strong>：即AFR, 创建volume 时带 replica x 数量: 将文件复制到 replica x 个节点中。</li>
<li><strong>条带模式</strong>：即Striped, 创建volume 时带 stripe x 数量： 将文件切割成数据块，分别存储到 stripe x 个节点中 ( 类似raid 0 )。</li>
<li><strong>分布式条带模式</strong>：最少需要4台服务器才能创建。 创建volume 时 stripe 2 server = 4 个节点： 是DHT 与 Striped 的组合型。</li>
<li><strong>分布式复制模式</strong>：最少需要4台服务器才能创建。 创建volume 时 replica 2 server = 4 个节点：是DHT 与 AFR 的组合型。</li>
<li><strong>条带复制卷模式</strong>：最少需要4台服务器才能创建。 创建volume 时 stripe 2 replica 2 server = 4 个节点： 是 Striped 与 AFR 的组合型。</li>
<li><strong>三种模式混合</strong>： 至少需要8台 服务器才能创建。 stripe 2 replica 2 , 每4个节点 组成一个 组。</li>
</ul>
<p>这几种模式的示例图参考：<a href="http://www.cnblogs.com/jicki/p/5801712.html">CentOS7安装GlusterFS</a>。</p>
<p>在此我们使用默认的<strong>分布卷模式</strong>。<strong>请勿在生产环境上使用该模式，容易导致数据丢失。</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 创建分布卷</span>
$ gluster volume create k8s-volume transport tcp k8s-master:/data/k8svol work-node1:/data/k8svol work-node2:/data/k8svol work-node3:/data/k8svol work-node4:/data/k8svol force

<span style="color:#75715e"># 查看volume状态</span>
$ gluster volume info
 
Volume Name: k8s-volume
Type: Distribute
Volume ID: deb413e6-19bf-4946-b40c-a3fe44feb26b
Status: Created
Snapshot Count: <span style="color:#ae81ff">0</span>
Number of Bricks: <span style="color:#ae81ff">5</span>
Transport-type: tcp
Bricks:
Brick1: k8s-master:/data/k8svol
Brick2: work-node1:/data/k8svol
Brick3: work-node2:/data/k8svol
Brick4: work-node3:/data/k8svol
Brick5: work-node4:/data/k8svol
Options Reconfigured:
transport.address-family: inet
storage.fips-mode-rchecksum: on
nfs.disable: on


<span style="color:#75715e"># 启动 分布卷</span>
$ gluster volume start k8s-volume
</code></pre></div><h2 id="glusterfs调优">Glusterfs调优</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 开启 指定 volume 的配额</span>
$ gluster volume quota k8s-volume enable

<span style="color:#75715e"># 限制 指定 volume 的配额</span>
$ gluster volume quota k8s-volume limit-usage / 1TB

<span style="color:#75715e"># 设置 cache 大小, 默认32MB</span>
$ gluster volume set k8s-volume performance.cache-size 4GB

<span style="color:#75715e"># 设置 io 线程, 太大会导致进程崩溃</span>
$ gluster volume set k8s-volume performance.io-thread-count <span style="color:#ae81ff">16</span>

<span style="color:#75715e"># 设置 网络检测时间, 默认42s</span>
$ gluster volume set k8s-volume network.ping-timeout <span style="color:#ae81ff">10</span>

<span style="color:#75715e"># 设置 写缓冲区的大小, 默认1M</span>
$ gluster volume set k8s-volume performance.write-behind-window-size 1024MB
</code></pre></div><h2 id="kubernetes中配置glusterfs">Kubernetes中配置glusterfs</h2>
<p>以下用到的所有yaml和json配置文件可以在<a href="https://github.com/rootsongjc/kubernetes-handbook/blob/master/manifests/glusterfs">../manifests/glusterfs</a>中找到。注意替换其中私有镜像地址为你自己的镜像地址。</p>
<h2 id="kubernetes安装客户端">kubernetes安装客户端</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 在所有 k8s node 中安装 glusterfs 客户端</span>

$ yum install -y glusterfs glusterfs-fuse

<span style="color:#75715e"># 配置 hosts</span>

$ vi /etc/hosts

172.20.0.113   test-001.jimmysong.io
172.20.0.114   test-002.jimmysong.io
172.20.0.115   test-003.jimmysong.io
</code></pre></div><p>因为我们glusterfs跟kubernetes集群复用主机，因为此这一步可以省去。</p>
<h2 id="配置-endpoints">配置 endpoints</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -O https://raw.githubusercontent.com/kubernetes/examples/master/volumes/glusterfs/glusterfs-endpoints.json

<span style="color:#75715e"># 修改 endpoints.json ，配置 glusters 集群节点ip</span>
<span style="color:#75715e"># 每一个 addresses 为一个 ip 组</span>

    <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;addresses&#34;</span>: <span style="color:#f92672">[</span>
        <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;ip&#34;</span>: <span style="color:#e6db74">&#34;172.22.0.113&#34;</span>
        <span style="color:#f92672">}</span>
      <span style="color:#f92672">]</span>,
      <span style="color:#e6db74">&#34;ports&#34;</span>: <span style="color:#f92672">[</span>
        <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;port&#34;</span>: <span style="color:#ae81ff">1990</span>
        <span style="color:#f92672">}</span>
      <span style="color:#f92672">]</span>
    <span style="color:#f92672">}</span>,

<span style="color:#75715e"># 导入 glusterfs-endpoints.json</span>

$ kubectl apply -f glusterfs-endpoints.json

<span style="color:#75715e"># 查看 endpoints 信息</span>
$ kubectl get ep
</code></pre></div><h2 id="配置-service">配置 service</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -O https://raw.githubusercontent.com/kubernetes/examples/master/volumes/glusterfs/glusterfs-service.json

<span style="color:#75715e"># service.json 里面查找的是 enpointes 的名称与端口，端口默认配置为 1，我改成了1990</span>

<span style="color:#75715e"># 导入 glusterfs-service.json</span>
$ kubectl apply -f glusterfs-service.json

<span style="color:#75715e"># 查看 service 信息</span>
$ kubectl get svc
</code></pre></div><h2 id="创建测试-pod">创建测试 pod</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -O https://raw.githubusercontent.com/kubernetes/examples/master/volumes/glusterfs/glusterfs-pod.json

<span style="color:#75715e"># 编辑 glusterfs-pod.json</span>
<span style="color:#75715e"># 修改 volumes  下的 path 为上面创建的 volume 名称</span>

<span style="color:#e6db74">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;k8s-volume&#34;</span>

<span style="color:#75715e"># 导入 glusterfs-pod.json</span>
$ kubectl apply -f glusterfs-pod.json

<span style="color:#75715e"># 查看 pods 状态</span>
$ kubectl get pods               
NAME                             READY     STATUS    RESTARTS   AGE
glusterfs                        1/1       Running   <span style="color:#ae81ff">0</span>          1m

<span style="color:#75715e"># 查看 pods 所在 node</span>
$ kubectl describe pods/glusterfs

<span style="color:#75715e"># 登陆 node 物理机，使用 df 可查看挂载目录</span>
$ df -h
172.20.0.113:k8s-volume <span style="color:#ae81ff">1073741824</span>        <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1073741824</span>   0% 172.20.0.113:k8s-volume  1.0T     <span style="color:#ae81ff">0</span>  1.0T   0% /var/lib/kubelet/pods/3de9fc69-30b7-11e7-bfbd-8af1e3a7c5bd/volumes/kubernetes.io~glusterfs/glusterfsvol
</code></pre></div><h2 id="配置persistentvolume">配置PersistentVolume</h2>
<p>PersistentVolume（PV）和 PersistentVolumeClaim（PVC）是kubernetes提供的两种API资源，用于抽象存储细节。管理员关注于如何通过pv提供存储功能而无需关注用户如何使用，同样的用户只需要挂载PVC到容器中而不需要关注存储卷采用何种技术实现。</p>
<p>PVC和PV的关系跟pod和node关系类似，前者消耗后者的资源。PVC可以向PV申请指定大小的存储资源并设置访问模式。</p>
<p>**PV属性 **</p>
<ul>
<li>storage容量</li>
<li>读写属性：分别为ReadWriteOnce：单个节点读写； ReadOnlyMany：多节点只读 ； ReadWriteMany：多节点读写</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat glusterfs-pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: gluster-dev-volume
spec:
  capacity:
    storage: 8Gi
  accessModes:
    - ReadWriteMany
  glusterfs:
    endpoints: <span style="color:#e6db74">&#34;glusterfs-cluster&#34;</span>
    path: <span style="color:#e6db74">&#34;k8s-volume&#34;</span>
    readOnly: false

<span style="color:#75715e"># 导入PV</span>
$ kubectl apply -f glusterfs-pv.yaml

<span style="color:#75715e"># 查看 pv</span>
$ kubectl get pv
NAME                 CAPACITY   ACCESSMODES   RECLAIMPOLICY   STATUS      CLAIM     STORAGECLASS   REASON    AGE
gluster-dev-volume   8Gi        RWX           Retain          Available                                      3s
</code></pre></div><p>PVC属性</p>
<ul>
<li>访问属性与PV相同</li>
<li>容量：向PV申请的容量 &lt;= PV总容量</li>
</ul>
<h2 id="配置pvc">配置PVC</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat glusterfs-pvc.yaml
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: glusterfs-nginx
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 8Gi

<span style="color:#75715e"># 导入 pvc</span>
$ kubectl apply -f glusterfs-pvc.yaml

<span style="color:#75715e"># 查看 pvc</span>

$ kubectl get pv
NAME              STATUS    VOLUME               CAPACITY   ACCESSMODES   STORAGECLASS   AGE
glusterfs-nginx   Bound     gluster-dev-volume   8Gi        RWX                          4s
</code></pre></div><h2 id="创建-nginx-deployment-挂载-volume">创建 nginx deployment 挂载 volume</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ vi nginx-deployment.yaml
apiVersion: extensions/v1beta1 
kind: Deployment 
metadata: 
  name: nginx-dm
spec: 
  replicas: <span style="color:#ae81ff">2</span>
  template: 
    metadata: 
      labels: 
        name: nginx 
    spec: 
      containers: 
        - name: nginx 
          image: nginx:alpine 
          imagePullPolicy: IfNotPresent
          ports: 
            - containerPort: <span style="color:#ae81ff">80</span>
          volumeMounts:
            - name: gluster-dev-volume
              mountPath: <span style="color:#e6db74">&#34;/usr/share/nginx/html&#34;</span>
      volumes:
      - name: gluster-dev-volume
        persistentVolumeClaim:
          claimName: glusterfs-nginx

<span style="color:#75715e"># 导入 deployment</span>
$ kubectl apply -f nginx-deployment.yaml 

<span style="color:#75715e"># 查看 deployment</span>
$ kubectl get pods |grep nginx-dm
nginx-dm-3698525684-g0mvt       1/1       Running   <span style="color:#ae81ff">0</span>          6s
nginx-dm-3698525684-hbzq1       1/1       Running   <span style="color:#ae81ff">0</span>          6s

<span style="color:#75715e"># 查看 挂载</span>
$ kubectl exec -it nginx-dm-3698525684-g0mvt -- df -h|grep k8s-volume
172.20.0.113:k8s-volume         1.0T     <span style="color:#ae81ff">0</span>  1.0T   0% /usr/share/nginx/html

<span style="color:#75715e"># 创建文件 测试</span>
$ kubectl exec -it nginx-dm-3698525684-g0mvt -- touch /usr/share/nginx/html/index.html

$ kubectl exec -it nginx-dm-3698525684-g0mvt -- ls -lt /usr/share/nginx/html/index.html
-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">0</span> May  <span style="color:#ae81ff">4</span> 11:36 /usr/share/nginx/html/index.html

<span style="color:#75715e"># 验证 glusterfs</span>
<span style="color:#75715e"># 因为我们使用分布卷，所以可以看到某个节点中有文件</span>
<span style="color:#f92672">[</span>root@test-001 ~<span style="color:#f92672">]</span> ls /opt/gfs_data/
<span style="color:#f92672">[</span>root@test-002 ~<span style="color:#f92672">]</span> ls /opt/gfs_data/
index.html
<span style="color:#f92672">[</span>root@test-003 ~<span style="color:#f92672">]</span> ls /opt/gfs_data/
</code></pre></div><h2 id="参考">参考</h2>
<ul>
<li><a href="http://www.cnblogs.com/jicki/p/5801712.html">CentOS 7 安装 GlusterFS</a></li>
</ul>

                    </div>
                    
                    
                    <div class="after-post-tags">
                        <ul class="tags">
                        
                        <li>
                        <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8">分布式存储</a>
                        </li>
                        
                        </ul>
                    </div>
                    
                    
                    
                    <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
                    
                        <a class="d-block col-md-6" href="https://magicletters.github.io/posts/adoc/asciidoctor%E7%94%9F%E6%88%90%E5%8C%85%E5%90%AB%E4%B8%AD%E6%96%87%E7%9A%84pdf/"> &laquo; asciidoctor生成包含中文的pdf</a>
                    
                    
                        <a class="d-block col-md-6 text-lg-right" href="https://magicletters.github.io/posts/glusterfs%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">Glusterfs的常用命令 &raquo;</a>
                    
                    <div class="clearfix"></div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
        
    </div>


            </div>
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
			<div class="d-md-flex align-items-center justify-content-center h-100">
				<h2 class="d-md-block d-none align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
			</div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
			
			<a class="mt-1 mb-1" href="/tags/adoc">adoc</a>
			
			<a class="mt-1 mb-1" href="/tags/arm">arm</a>
			
			<a class="mt-1 mb-1" href="/tags/clion">clion</a>
			
			<a class="mt-1 mb-1" href="/tags/cpp">cpp</a>
			
			<a class="mt-1 mb-1" href="/tags/docker">docker</a>
			
			<a class="mt-1 mb-1" href="/tags/golang">golang</a>
			
			<a class="mt-1 mb-1" href="/tags/ide">ide</a>
			
			<a class="mt-1 mb-1" href="/tags/java">java</a>
			
			<a class="mt-1 mb-1" href="/tags/k8s">k8s</a>
			
			<a class="mt-1 mb-1" href="/tags/raft">raft</a>
			
			<a class="mt-1 mb-1" href="/tags/shell">shell</a>
			
			<a class="mt-1 mb-1" href="/tags/spring">spring</a>
			
			<a class="mt-1 mb-1" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8">分布式存储</a>
			
			<a class="mt-1 mb-1" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式</a>
			
		</div>
	</div>
</div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Zhu Jia - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" rel="noopener" href="https://www.wowthemes.net">Mediumish Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>


        </div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script src="/js/mediumish.js"></script>

    </body>
</html>
